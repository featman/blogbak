title: 复习笔记-网络归纳  
date: 2015-4-12 12:51:44
categories: 总结复习
tags: [知识点整理,计算机网络] 
---
总结复习，网络知识点
<!--more-->
### 1.路由汇聚
如果一个路由表中有很多相近的网段，这些相近到网段独占一条路由记录，这样系统维护到路由表就会比较大，效率就不会很高，所以如果把相近到网段聚合 在一起，使之成为一条路由记录，这样在搜索路由表到时候，效率就会提高。
具体做法：
> 有三条路由：  
> 192.168.128.0/24  
> 192.168.130.0/24  
> 192.168.132.0/24    

如果进行路由汇聚，则能汇聚到网段为：
- a.首先我么应该观察这三条路由不同de字节数，写出他们的二进制。
- b.192.168 一样就不用写了。所以从第三个字节算起。
- 1000 0000
- 1000 0010
- 1000 0100
- c.通过上边到分解可以看出，前5个比特位是一样的，所以聚合后的掩码为5，在加上前边的两个字节是8+8+5 = 21.
- 前5个比特位固定住后，后边剩下到三个补0，则十进制为128.
- d.所以，得到到聚合网段为192.168.128.0/21

### 2.常用2进制转换
128    1000 0000  
127    0111 1111  
240    1111 0000  
168    1010 1000  
192    1100 0000  
172    1010 1100  
### 3.16进制和2进制转换
十六进制是分为两个字符，前边到一个正好对应2进制到前四个，后边到一个对应2进制的后四个。各算各的。
逻辑中要用10进制中转。

### 4.子网划分
实际上是根ip地址到类型来划分的，比如一个C类地址，那么它默认到mask是24,子网演码是采用借位来去做的，借主机的位（不能借网络的位），这样一个网络就是由主机地址+子网地址+网络地址组成。有多少个子网，就看像主机借了多少位，有多少个主机就看主机还剩下多少位。比如借来两位，那么子网就为2的2次方，剩下6位，那么主机就为2到6次方-2（剪2是因为子网内第一个是网段地址，最后一个是广播地址，所以都不可以给主机使用。）

### 5.如果把一个网络40.15.0.0分为两个子网，第一个子网是40.15.0.0/17,第二个子网为多少？

首先根据题目可以知道40.15.0.0是一个A类网，既然第一个子网也是40.15开头到，那么可以知道这个40.15.0.0这个其实也是从40这个网段划分出来到一个子网。这个我们就不用考虑，只需知道40.15.0.0到子网演码为255.255.0.0就可以了。由于是两个子网，所以应该是2到1次方，则子网演码中的第三个字节为1000 0000，由此可知，每个子网有2的7+8次方个主机-2。演码第一位为1，则真实网段中可以变成0或者1，如果是0，则是条件中到那个，如果是1，则为128，即40.15.128.0/17.这个网段中主机范围应该是40.15.128.1~40.15.255.254.
### 6.TCP是如何提供可靠连接的？
**（三次握手四次分手、[拥塞处理](http://blog.sina.com.cn/s/blog_48ebca64010003t0.html)、滑动窗口、检验和、超时重传）**
> a.拥塞处理机制：这个是在本地发送端做的处理，需要一个拥塞窗口，这个窗口的大小应该是动态变化的，默认是一个MSS的大小，应用一些算法（慢启动、拥塞避免、快速重发、快速恢复），比如说慢启动，就是当一个连接建立起来之后，并不能往网络中发送大量的数据，因为并不知道网络状态是好的，还是不好的，所以应该第一次发送一个MSS，第二次发送两个MSS，第三次发送4个MSS。。。以此类堆，先成指数增长，同时设置一个峰值（为默认的对方窗口大小 65535个字节），就按照这个大小来发，这样做提高来网络的利用率。如果发生来拥塞（发送端接到来相同的ACK回复或者根本没有回复），那么首先
> 
> > -  1.减少峰值的大小，减少一半。
> > -  2.同时再从一个MSS发送数据。
> > -  3.继续慢启动的过程
>  
> 上述过程就为慢启动和拥塞避免算法。
> 
> b.当TCP发送出去一个段后，本地会有一个定时器启动起来，这个定时器在某一时间内如果收不到对方的应答，则证明本次发送失败，就会进行重传处理。
> c.当TCP收到一个数据后，要进行ACK的确认给发送方。
> 
> d. TCP保持在它首部的检验和，这个检验和是包含TCP头和应用数据的。这样在传输到过程中，如果数据有丢失，接收方通过重算检验和会发现异常，丢弃这个包。而UDP的检验和虽然有，但默认是关闭的，所以不可靠。
> e.滑动窗口机制。是接收端的一个窗口，每次接收端都会给发送端回复的包中，含有接收端接收缓冲区的剩余大小。这样在发送端往本地发送数据的时候就不会多发，因为多发，会导致本地接收缓冲区溢出，造成数据的丢失。滑动窗口并不能判断网络的拥塞情况，只是判断缓冲区的大小。判断拥塞应该是拥塞窗口的事情。
> 
> f.与UDP相比，它是有一个三次握手，四次分手的过程。

### 7.TCP 连接 TIME_WAIT
![image description](http://7xkz95.com1.z0.glb.clouddn.com/15-8-10/55067698.jpg)

> 上述到TIME_WAIT状态是2MSL（max segment life），意思就是当结束连接的时候，必须要等待一段时间。
> 具体过程是：当服务端发给客户最后一个FIN之后，服务端要等待ACK，这时候，客户端会给服务端回ACK，假如ACK没有传送至服务端，如果没有TIMEWAIT机制的话，客户端就可以直接关闭掉，倒是后服务端就关不上来。所以应该设置一个等待时间，如果服务端往客户端发送FIN，超时来再重发，这时候由于有TIME——WAIT所以客户端再次接收一个FIN，则此时就会再给服务端发一个ACK。

### 8.FTP主动模式和被动模式

主动模式：
> FTP客户机向服务器的FTP控制端口（默认是21）发送请求，服务器接受连接，建立一条命令链路，当需要传送数据时候，客户端在命令链路上用PORT命令告诉服务器：“我打开了某个端口，你过来连接我。”于是服务器从20端口向客户端的改端口发送连接请求，建立一条数据链路来传送数据。在数据链路建立的过程中是服务器主动请求，所以称为主动模式。 
> FTP 主动模式（命令行是主动模式）
> 服务器用20号端口，主动连接客户机的大于1024的随机端口。
> 
> 被动模式：
> FTP客户端向服务器的FTP控制端口发送连接请求，服务器接收连接，建立一条命令链路，当需要传送数据时候，服务器在命令链路上用PASV命令告诉客户端；“我打开了某端口，你过来连接我。”于是客户端向服务器的该端口发送连接请求，建立一条数据链路来传送数据。在数据链路建立的过程中是服务器被动等待客户端请求，所以称为被动模式。

---

> FTP被动模式
> 客户机用大于1024的随机端口，主动连接服务器大于1024的随机端口。
> 
> 主动模式下的FTP服务器，需要在服务器和客户端之间的防火墙中设置一下策越：
> 允许FTP客户机从大于1024的端口连接FTP服务器的21端口
> 允许FTP服务器从21端口回应FTP客户机中大于1024端口的网络连接。
> 允许FTP服务器从20端口主动连接FTP客户机中大于1024的端口
> 允许FTP客户机从大于1024的端口回应来自FTP服务器20端口的网络连接
> 
> 被动模式下的FTP服务器，需要在服务器和客户端之间的防火墙中设置一下策越：
> 允许FTP客户机从大于1024的端口连接FTP服务器的21端口
> 允许FTP服务器从21端口回应FTP客户机中大于1024端口的网络连接。
> 允许FTP客户机从大于1024端口主动连接FTP服务器中大于1024的端口
> 允许FTP服务器从大于1024的端口回应来自FTP客户机大于1024端口的网络连接
![image description](http://7xkz95.com1.z0.glb.clouddn.com/15-8-10/20845911.jpg)

### 9.既然已经有了ip的分片，那么为什么还需要有tcp的分段？
![image description](http://7xkz95.com1.z0.glb.clouddn.com/15-8-10/72824121.jpg)

### 10.[数据帧封装格式、MTU、MSS](http://infotech.blog.51cto.com/391844/123859 )
![image description](http://7xkz95.com1.z0.glb.clouddn.com/15-8-10/12035922.jpg)

### 11.TCP、UDP、IP报文头部
![image description](http://7xkz95.com1.z0.glb.clouddn.com/15-8-10/22300570.jpg)![image description](http://7xkz95.com1.z0.glb.clouddn.com/15-8-10/48048979.jpg)

![image description](http://7xkz95.com1.z0.glb.clouddn.com/15-8-10/59323400.jpg)
### 12.iptables
![image description](http://7xkz95.com1.z0.glb.clouddn.com/15-8-10/41832642.jpg)
### 13.三次握手
![image description](http://7xkz95.com1.z0.glb.clouddn.com/15-8-10/40534034.jpg)
### NAT透传！
![image description](http://7xkz95.com1.z0.glb.clouddn.com/15-8-10/2700751.jpg)